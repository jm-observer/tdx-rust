# TDX Rust

é€šè¾¾ä¿¡åè®®è§£æçš„ Rust å®ç°ï¼Œç”¨äºè·å–è‚¡ç¥¨ä¿¡æ¯ã€‚

è¿™æ˜¯ä¸€ä¸ªåŸºäº https://github.com/injoyai/tdx å®ç°çš„ Rust ç‰ˆæœ¬ é€šè¾¾ä¿¡åè®®è§£æåº“ï¼Œç”¨äºè·å–Aè‚¡/è‚¡ç¥¨ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚è¡Œæƒ…ã€Kçº¿ã€åˆ†æ—¶ç­‰æ•°æ®ï¼‰ã€‚
ç‰¹åˆ«æ„Ÿè°¢åŸ Go è¯­è¨€ç‰ˆæœ¬ä½œè€… injoyai çš„ä¼˜ç§€å·¥ä½œå’Œå¼€æºè´¡çŒ®ï¼
åŸé¡¹ç›®åœ°å€ï¼šhttps://github.com/injoyai/tdx ï¼ˆä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ç¤¾åŒºè®¤å¯åº¦è¾ƒé«˜çš„é€šè¾¾ä¿¡åè®® Go å®ç°

## åŠŸèƒ½ç‰¹æ€§

- âœ… å®Œæ•´çš„åè®®å¸§æ ¼å¼æ”¯æŒï¼ˆè¯·æ±‚å¸§å’Œå“åº”å¸§ï¼‰
- âœ… æ•°æ®ç¼–ç /è§£ç å·¥å…·ï¼ˆå°ç«¯åºã€å˜é•¿æ•´æ•°ã€ä»·æ ¼ç¼–ç ç­‰ï¼‰
- âœ… TCP å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
- âœ… å¤šç§è¿æ¥æ–¹å¼ï¼ˆå•ä¸ªåœ°å€ã€å¤šä¸ªåœ°å€è½®è¯¢/éšæœº/éå†ï¼‰
- âœ… å¤šç§æ¶ˆæ¯ç±»å‹æ”¯æŒï¼š
  - å»ºç«‹è¿æ¥
  - å¿ƒè·³åŒ…
  - è·å–è‚¡ç¥¨æ•°é‡
  - è·å–è‚¡ç¥¨ä»£ç åˆ—è¡¨
  - è¡Œæƒ…ä¿¡æ¯ï¼ˆ5æ¡£æŠ¥ä»·ï¼‰
  - Kçº¿æ•°æ®ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - åˆ†æ—¶æ•°æ®ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
  - åˆ†æ—¶æˆäº¤ï¼ˆéƒ¨åˆ†å®ç°ï¼‰

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```rust
use tdx_sync_rust::*;

fn main() -> Result<(), ClientError> {
    // è¿æ¥åˆ°æœåŠ¡å™¨
    let client = dial("124.71.187.122")?;
    
    // è·å–è‚¡ç¥¨æ•°é‡
    let count = client.get_count(Exchange::SH)?;
    println!("ä¸Šæµ·äº¤æ˜“æ‰€è‚¡ç¥¨æ•°é‡: {}", count);
    
    // è·å–è‚¡ç¥¨ä»£ç åˆ—è¡¨
    let codes = client.get_code(Exchange::SH, 0)?;
    println!("è·å–åˆ° {} åªè‚¡ç¥¨", codes.codes.len());
    
    // è·å–è¡Œæƒ…ä¿¡æ¯
    let quotes = client.get_quote(&["sz000001".to_string(), "sh600000".to_string()])?;
    for quote in quotes {
        println!("è‚¡ç¥¨: {}{}, æ”¶ç›˜ä»·: {:.2}å…ƒ", 
            quote.exchange.as_str(), quote.code, quote.k.close.to_yuan());
    }
    
    Ok(())
}
```

### è¿æ¥æ–¹å¼

```rust
// æ–¹å¼1: è¿æ¥åˆ°æŒ‡å®šåœ°å€
let client = dial("124.71.187.122")?;

// æ–¹å¼2: éå†å¤šä¸ªåœ°å€è¿æ¥ï¼ˆæ¨èï¼Œè‡ªåŠ¨é‡è¯•ï¼‰
let client = dial_hosts_range(&["124.71.187.122", "122.51.120.217"])?;

// æ–¹å¼3: éšæœºé€‰æ‹©ä¸€ä¸ªåœ°å€è¿æ¥
let client = dial_hosts_random(&["124.71.187.122", "122.51.120.217"])?;

// æ–¹å¼4: ä½¿ç”¨é»˜è®¤è¿æ¥æ–¹å¼ï¼ˆéå†é»˜è®¤æœåŠ¡å™¨åˆ—è¡¨ï¼‰
let client = dial_default()?;
```

### æµ‹è¯•æœåŠ¡å™¨è¿æ¥é€Ÿåº¦

```rust
use tdx_sync_rust::*;

let hosts = &["124.71.187.122", "122.51.120.217", "111.229.247.189"];
let results = fast_hosts(hosts);

for result in results {
    println!("{} - {:.2}ms", result.host, result.duration.as_secs_f64() * 1000.0);
}
```

## è¿è¡Œç¤ºä¾‹

```bash
# åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
cargo run --example basic

# æµ‹è¯•æœåŠ¡å™¨è¿æ¥é€Ÿåº¦
cargo run --example fast_hosts
```

## é¡¹ç›®ç»“æ„

```
tdx-sync-rust/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£
â”‚   â”œâ”€â”€ client.rs           # TCP å®¢æˆ·ç«¯å®ç°
â”‚   â”œâ”€â”€ dial.rs             # è¿æ¥ç®¡ç†
â”‚   â””â”€â”€ protocol/
â”‚       â”œâ”€â”€ mod.rs          # åè®®æ¨¡å—å…¥å£
â”‚       â”œâ”€â”€ constants.rs    # å¸¸é‡å®šä¹‰
â”‚       â”œâ”€â”€ frame.rs        # å¸§æ ¼å¼ç¼–è§£ç 
â”‚       â”œâ”€â”€ types.rs        # æ•°æ®ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ codec.rs        # ç¼–ç /è§£ç å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ messages.rs     # å„ç§æ¶ˆæ¯ç±»å‹çš„ç¼–è§£ç 
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic.rs            # åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ fast_hosts.rs      # æµ‹è¯•æœåŠ¡å™¨è¿æ¥é€Ÿåº¦ç¤ºä¾‹
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ protocol_test.rs    # åè®®æµ‹è¯•
â””â”€â”€ tdx-test/               # æµ‹è¯•æ•°æ®
```

## ä¾èµ–

- `bytes` - å­—èŠ‚æ“ä½œ
- `flate2` - zlib å‹ç¼©/è§£å‹
- `encoding_rs` - GBK/UTF-8 ç¼–ç è½¬æ¢
- `thiserror` - é”™è¯¯å¤„ç†
- `tokio` - å¼‚æ­¥è¿è¡Œæ—¶ï¼ˆéƒ¨åˆ†åŠŸèƒ½ï¼‰
- `rand` - éšæœºæ•°ç”Ÿæˆ
- `serde` / `serde_json` - JSON åºåˆ—åŒ–ï¼ˆæµ‹è¯•æ•°æ®ï¼‰

## å¼€å‘çŠ¶æ€

å½“å‰å®ç°äº†ï¼š
- âœ… åŸºç¡€åè®®æ¡†æ¶
- âœ… TCP å®¢æˆ·ç«¯è¿æ¥
- âœ… åŸºæœ¬æ¶ˆæ¯ç±»å‹ï¼ˆè¿æ¥ã€å¿ƒè·³ã€æ•°é‡ã€ä»£ç ã€è¡Œæƒ…ï¼‰
- âœ… è¿æ¥ç®¡ç†ï¼ˆå¤šç§è¿æ¥æ–¹å¼ï¼‰
- âœ… æµ‹è¯•æ•°æ®éªŒè¯

æ­£åœ¨å¼€å‘ï¼š
- ğŸ”„ å®Œæ•´çš„è¡Œæƒ…è§£æï¼ˆ5æ¡£æŠ¥ä»·ã€æˆäº¤é‡ç­‰ï¼‰
- ğŸ”„ Kçº¿æ•°æ®å®Œæ•´å®ç°
- ğŸ”„ åˆ†æ—¶æ•°æ®å’Œæˆäº¤æ•°æ®
- ğŸ”„ å¼‚æ­¥å®¢æˆ·ç«¯æ”¯æŒ
- ğŸ”„ è¿æ¥æ± ç®¡ç†

## å‚è€ƒ

- [åè®®æ–‡æ¡£](./tdx-protocol.md) - å®Œæ•´çš„åè®®æ–‡æ¡£
- [æµ‹è¯•æ•°æ®](./tdx-test/) - æµ‹è¯•æ•°æ®å’ŒéªŒè¯å·¥å…·
- [injoyai/tdx](https://github.com/injoyai/tdx) - Go è¯­è¨€å‚è€ƒå®ç°

## License

MIT
